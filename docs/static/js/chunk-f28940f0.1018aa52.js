(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f28940f0"],{"15ec":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("el-table",{staticStyle:{width:"100%","margin-top":"30px"},attrs:{data:e.rolechannelLists,border:""}},[n("el-table-column",{attrs:{align:"center",label:"角色归属",width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v(e._s(n.role_name))]}}])}),e._v(" "),n("el-table-column",{attrs:{align:"center",label:"渠道列表"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return e._l(a.channel_name,function(t){return n("el-tag",{key:t.id,attrs:{label:t.name,value:t.name}},[e._v(e._s(t.name))])})}}])}),e._v(" "),n("el-table-column",{attrs:{align:"header-center",label:"描述"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v(e._s(n.description))]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"更新时间",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[n("span",[e._v(e._s(e._f("parseTime")(a.update_time,"{y}-{m}-{d} {h}:{i}")))])]}}])}),e._v(" "),n("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e.checkPermission(["admin"])?n("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.handleEdit({row:a})}}},[e._v("编辑修改")]):e._e()]}}])})],1),e._v(" "),n("el-dialog",{attrs:{visible:e.dialogVisible,title:"edit"===e.dialogType?"编辑渠道权限":""},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("el-form",{ref:"channel",attrs:{model:e.channel,rules:e.rules,"label-width":"80px","label-position":"left"}},[n("el-form-item",{attrs:{label:"角色归属",prop:"role_name"}},[n("el-select",{attrs:{width:"220",placeholder:"角色选择",clearable:""},model:{value:e.channel.role_name,callback:function(t){e.$set(e.channel,"role_name",t)},expression:"channel.role_name"}},e._l(e.rolesnamelist,function(e){return n("el-option",{key:e.value,attrs:{label:e,value:e}})}),1)],1),e._v(" "),n("el-form-item",{attrs:{label:"渠道列表",prop:"channel_name"}},[n("el-tree",{ref:"tree",staticClass:"permission-tree",attrs:{"check-strictly":e.checkStrictly,data:e.routesData,props:e.defaultProps,"show-checkbox":"","node-key":"id","default-expand-all":"","highlight-current":""}})],1),e._v(" "),n("el-form-item",{attrs:{label:"用户描述",prop:"description"}},[n("el-input",{attrs:{autosize:{minRows:3,maxRows:4},type:"textarea",placeholder:"请输入用户描述"},model:{value:e.channel.description,callback:function(t){e.$set(e.channel,"description",t)},expression:"channel.description"}})],1)],1),e._v(" "),n("div",{staticStyle:{"text-align":"right"}},[n("el-button",{attrs:{type:"danger"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.confirmRole("channel")||e.getCheckedNodes()}}},[e._v("确认")])],1)],1)],1)},r=[],i=(n("96cf"),n("3b8d")),l=n("5176"),c=n.n(l),s=n("ed08"),o=n("b775");function u(){return Object(o["a"])({url:"/channels",method:"get"})}function d(){return Object(o["a"])({url:"/channelnameslist",method:"get"})}function h(e,t){return Object(o["a"])({url:"/channel/".concat(e),method:"put",params:{data:t}})}var f=n("cc5e"),p=n("e350"),m={id:"",role_name:"",channel_name:[],game_package_name:"",update_user:"",description:""},g={data:function(){return{checkAll:!1,channel:c()({},m),rolechannelLists:[],channellist:[],rolesnamelist:[],isIndeterminate:!0,dialogVisible:!1,dialogType:"new",rules:{role_name:[{required:!0,message:"请选择角色组",trigger:"change"}],channel_name:[{type:"array",required:!0,message:"请至少选择一个渠道",trigger:"change"}]},checkStrictly:!1,defaultProps:{children:"children",label:"name"}}},computed:{routesData:function(){return this.channellist}},created:function(){this.getRolechannels(),this.getChannellist(),this.getRoleslistname()},methods:{checkPermission:p["a"],getRolechannels:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,u();case 2:t=e.sent,this.rolechannelLists=t.data;case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),getChannellist:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,d();case 2:t=e.sent,this.channellist=t.data;case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),getRoleslistname:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(f["d"])();case 2:t=e.sent,this.rolesnamelist=t.data;case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),handleEdit:function(e){var t=this,n=e.row;this.dialogType="edit",this.dialogVisible=!0,this.checkStrictly=!0,this.channel=Object(s["a"])(n),this.$nextTick(function(){t.checkStrictly=!1,t.$refs.tree.setCheckedNodes(n.channel_name)})},confirmRole:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t){var n=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.$refs[t].validate(function(e){var t="edit"===n.dialogType;if(e){if(n.channel.update_time=(new Date).getTime(),n.channel.channel_name=n.$refs.tree.getCheckedNodes(),t){h(n.channel.id,n.channel);for(var a=0;a<n.rolechannelLists.length;a++)if(n.rolechannelLists[a].id===n.channel.id){n.rolechannelLists.splice(a,1,c()({},n.channel));break}}var r=n.channel,i=r.description,l=r.role_name,s=r.game_package_name;n.dialogVisible=!1,n.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"\n            <div>角色归属: ".concat(l,"</div>\n            <div>包体名称: ").concat(s,"</div>\n            <div>描述: ").concat(i,"</div>\n          "),type:"success"})}});case 1:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()}},v=g,_=(n("49f4"),n("2877")),b=Object(_["a"])(v,a,r,!1,null,"311cae85",null);t["default"]=b.exports},"49f4":function(e,t,n){"use strict";var a=n("896a"),r=n.n(a);r.a},"896a":function(e,t,n){},e350:function(e,t,n){"use strict";n.d(t,"a",function(){return r});n("6762"),n("2fdb");var a=n("4360");function r(e){if(e&&e instanceof Array&&e.length>0){var t=a["a"].getters&&a["a"].getters.roles,n=e,r=t.some(function(e){return n.includes(e)});return!!r}return console.error("need roles! Like v-permission=\"['admin','editor']\""),!1}}}]);